<!DOCTYPE html>
<!--[if lt IE 7 ]>
<html lang="en" class="no-js ie6 lt8"> <![endif]-->
<!--[if IE 7 ]>
<html lang="en" class="no-js ie7 lt8"> <![endif]-->
<!--[if IE 8 ]>
<html lang="en" class="no-js ie8 lt8"> <![endif]-->
<!--[if IE 9 ]>
<html lang="en" class="no-js ie9"> <![endif]-->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>真白萌 | 登录</title>

    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" type="text/css" href="/css/login/demo.css"/>
    <link rel="stylesheet" type="text/css" href="/css/login/style.css"/>
    <link rel="stylesheet" type="text/css" href="/css/login/animate-custom.css"/>
    <link rel="stylesheet" type="text/css"
          href="https://masiro.me/vendor/laravel-admin/sweetalert2/dist/sweetalert2.css"/>


    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
      .activationcode-icon:after {
        font-size: 20px !important;
        line-height: 15px;
      }

      .nkname:after {
        font-size: 20px !important;
        line-height: 15px;
      }

      .activationcode-get {
        margin-left: 5px;
        display: inline-block;
        font-weight: bold;
        background: rgb(247, 248, 241);
        padding: 5px 7px;
        color: rgb(29, 162, 193);
        margin-left: 10px;
        text-decoration: none;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        border: 1px solid rgb(203, 213, 214);
        -webkit-transition: all 0.4s linear;
        -moz-transition: all 0.4s linear;
        -o-transition: all 0.4s linear;
        -ms-transition: all 0.4s linear;
        transition: all 0.4s linear;
        cursor: pointer;
      }

      .swal2-popup {
        width: 300px;
      }

      .change_link {
        width: 88%;
      }

      @media screen and (max-width: 960px) {
        #wrapper {
          width: calc(100% - 20px);
        }

        .change_link {
          width: calc(88% - 21px) !important;
        }

        .activationcode {
          width: 43% !important;
        }
      }
    </style>
</head>
<body>
<div class="container">
    <header>
        <nav class="codrops-demos">
            <h1>Masiro</h1>
        </nav>
    </header>
    <section>
        <div id="container_demo">

            <a class="hiddenanchor" id="toregister"></a>
            <a class="hiddenanchor" id="tologin"></a>
            <a class="hiddenanchor" id="toforget"></a>
            <div id="wrapper">
                <div id="login" class="animate form">
                    <form action="https://masiro.me/admin/auth/login" id="loginForm" method="post" autocomplete="on">
                        <h1>登录</h1>
                        <p>
                            <label for="username" class="uname" data-icon="u"> 账号 </label>
                            <input id="username" class="input-control" name="username" value type="text"
                                   placeholder="请输入用户名或邮箱"/>
                        </p>
                        <p class="password-box">
                            <label for="password" class="youpasswd" data-icon="p"> 密码 </label>
                            <input id="password" class="input-control" name="password" type="password"
                                   placeholder="请输入密码"/>
                        </p>
                        <p class="email-box" style="display: none;">
                            <label class="activationcode-icon" for="activationcode" data-icon="☪">邮箱验证码</label><br>
                            <input class="activationcode" style="width: 60%;" placeholder="请输入邮箱获取的验证码"
                                   name="activationcode" type="text"/>
                            <button type="button" class="button activationcode-get" onclick="sendLoginMail(30)">
                                获取验证码
                            </button>
                        </p>
                        <p class="keeplogin">
                            <input type="checkbox" name="remember" id="remember" value="1" checked>
                            <label for="remember">记住密码</label>
                        </p>
                        <p class="login button">
                            <input type="hidden" name="_token" value="5720xg7QBWmk4KKtiAZAce77jT6NqkvY29CjdakA">
                            <input type="button" id="login-btn" value="Login"/>
                        </p>
                        <p class="change_link">
                            <a href="#toforget" class="to_forget">忘记密码 ?</a>
                            <a href="#toregister" class="to_register">去注册</a>
                        </p>
                    </form>
                </div>
                <div id="register" class="animate form">
                    <form action="#" id="registerform" autocomplete="on">
                        <h1> 注册 </h1>
                        <p>
                            <label for="username" class="uname" data-icon="u">用户名</label>
                            <input id="usernamesignup" class="input-control" name="username" placeholder="请输入用户名"
                                   required="required" type="text"/>
                        </p>
                        <p>
                            <label for="name" class="nkname" data-icon="✦">昵称</label>
                            <input id="namesignup" class="input-control" name="name" placeholder="请输入昵称"
                                   required="required" type="text"/>
                        </p>
                        <p>
                            <label for="email" class="youmail" data-icon="e"> 邮箱</label>
                            <input id="emailsignup" class="input-control" placeholder="请输入邮箱" name="email"
                                   required="required" type="email"/>
                        </p>
                        <p>
                            <label class="activationcode-icon" for="activationcode" data-icon="☪"> 激活码</label>
                            <label style="color: red;font-size: 13px;margin-left: 10px;"
                                   class="activationeError"></label>
                            <br>
                            <input class="activationcode" style="width: 60%;" placeholder="请输入邮箱获取的激活码"
                                   name="activationcode" required="required" type="text"/>
                            <button type="button" class="button activationcode-get" onclick="sendMail(30)">获取激活码
                            </button>
                        </p>
                        <p>
                            <label for="password" class="youpasswd" data-icon="p">密码 </label>
                            <input id="passwordsignup" class="input-control" placeholder="请输入密码" name="password"
                                   required="required" type="password"/>
                        </p>
                        <p>
                            <label for="password_confirm" class="youpasswd" data-icon="p">请重复输入密码 </label>
                            <input id="passwordsignup_confirm" class="input-control" placeholder="请重复输入密码"
                                   name="password_confirm" required="required" type="password">
                        </p>
                        <p class="reset button">
                            <input type="hidden" class="csrf" name="_token"
                                   value="5720xg7QBWmk4KKtiAZAce77jT6NqkvY29CjdakA">
                            <input type="button" id="register-btn" value="Sign up"/>
                        </p>
                        <p class="change_link">
                            您已注册 ?
                            <a href="#tologin" class="to_login"> 去登录 </a>
                        </p>
                    </form>
                </div>
                <div id="forget" class="animate form">
                    <form action="#" id="forgetform" autocomplete="on">
                        <h1> 重置密码 </h1>
                        <p>
                            <label for="username" class="uname" data-icon="u">账号</label>
                            <input id="f-username" class="input-control" name="username"
                                   placeholder="请输入用户名或邮箱" required="required" type="text"/>
                        </p>
                        <p>
                            <label class="activationcode-icon" for="activationcode" data-icon="☪"> 验证码</label>
                            <label style="color: red;font-size: 13px;margin-left: 10px;"
                                   class="activationeError"></label>
                            <br>
                            <input class="activationcode" id="f-activationcode" style="width: 60%;"
                                   placeholder="请输入邮箱获取的验证码" name="activationcode" required="required"
                                   type="text"/>
                            <button type="button" class="button activationcode-get" onclick="sendResetMail(30)">
                                获取验证码
                            </button>
                        </p>
                        <p>
                            <label for="password" class="youpasswd" data-icon="p">新密码 </label>
                            <input id="f-password" class="input-control" placeholder="请输入密码" name="password"
                                   required="required" type="password"/>
                        </p>
                        <p>
                            <label for="password_confirm" class="youpasswd" data-icon="p">请重复输入密码 </label>
                            <input id="f-password_confirm" class="input-control" placeholder="请重复输入密码"
                                   name="password_confirm" required="required" type="password">
                        </p>
                        <p class="signin button">
                            <input type="button" id="reset-btn" value="Reset"/>
                        </p>
                        <p class="change_link">
                            <a href="#tologin" class="to_login"> 去登录 </a>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </section>
</div>


<script src="https://masiro.me/vendor/laravel-admin/AdminLTE/plugins/jQuery/jQuery-2.1.4.min.js "></script>

<script src="https://masiro.me/vendor/laravel-admin/AdminLTE/bootstrap/js/bootstrap.min.js"></script>
<script src="https://masiro.me/vendor/laravel-admin/sweetalert2/dist/sweetalert2.min.js"></script>


<script>

    function sendMail(t) {
        var email = $('#emailsignup').val();
        var csrf = $('.csrf').val();
        if (!email) {
            $('.activationeError').html('请填写邮箱！');
            $(email).focus();
            return false;
        }
        if (/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(email) == false) {
            $('.activationeError').html('邮箱格式不正确！');
            $(email).focus();
            return false;
        }
        const whiteList = ['masiro.me', 'qq.com', 'gmail.com', 'googlemail.com', 'hotmail.com', 'outlook.com', '163.com', '126.com', 'yahoo.com', 'yahoomail.com', 'sohu.com', 'sina.com'];
        if (!whiteList.includes(email.split('@')[1])) {
            $('.activationeError').html('该邮箱域名不在白名单中！');
            $(email).focus();
            return false;
        }
        $('.activationcode-get').attr("disabled", true);
        for (i = 1; i <= t; i++) {
            window.setTimeout("update_p(" + i + "," + t + ")", i * 1000);
        }

        $.post("/mail/send", {"email": email, '_token': csrf}, function (res) {
            if (res.code == 1) {
                swal('邮件发送成功!', '', 'success');
            } else {
                swal(res.msg, '', 'error');
            }
        }, 'json');

    }

    function sendLoginMail(t) {
        var username = $('#username').val();
        var csrf = $('.csrf').val();
        if (!username) {
            swal('账号不能为空!', '', 'error');
            return false;
        }

        $('.activationcode-get').attr("disabled", true);
        for (i = 1; i <= t; i++) {
            window.setTimeout("update_p(" + i + "," + t + ")", i * 1000);
        }

        $.post("/mail/login", {"username": username, '_token': csrf}, function (res) {
            if (res.code == 1) {
                swal('邮件发送成功!', '', 'success');
            } else {
                swal(res.msg, '', 'error');
            }
        }, 'json');

    }

    function sendResetMail(t) {
        var username = $('#f-username').val();
        var csrf = $('.csrf').val();
        if (!username) {
            swal('账号不能为空!', '', 'error');
            return false;
        }

        $('.activationcode-get').attr("disabled", true);
        for (i = 1; i <= t; i++) {
            window.setTimeout("update_p(" + i + "," + t + ")", i * 1000);
        }

        $.post("/mail/active", {"username": username, "title": "重置密码", '_token': csrf}, function (res) {
            if (res.code == 1) {
                swal('邮件发送成功!', '', 'success');
            } else {
                swal(res.msg, '', 'error');
            }
        }, 'json');

    }

    function update_p(num, t) {
        if (num == t) {
            $('.activationcode-get').html("重新发送");
            $('.activationcode-get').attr("disabled", false);
        } else {
            printnr = t - num;
            $('.activationcode-get').html("(" + printnr + ")秒后重新发送");
        }
    }

    $(function () {

        var screenWidth = $(window).width();
        // if (screenWidth < 1000) {
        //   $("#wrapper").width(screenWidth*0.9);
        //   $(".change_link").width($('#login').width()-20);
        //   $(".input-control").width("88%");
        //   $(".activationcode").width("43%");

        // }

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('.csrf').val()
            }
        });
        //注册
        $("#register-btn").click(function () {
            const thisBtn = this;
            thisBtn.disabled = true;
            thisBtn.value = 'loading';
            $.ajax({
                type: 'post',
                url: '/register',
                dataType: 'json',
                data: $("#registerform").serialize(),
                success: function (data) {
                    if (data.code == 1) {
                        swal('注册成功!', '', 'success');
                        setTimeout(function () {
                            window.location.href = data.url;
                        }, 1000);

                    } else if (data.code == -1) {
                        swal(data.msg, '', 'error');
                        thisBtn.disabled = false;
                        thisBtn.value = 'Sign up';
                    } else {
                        swal('系统错误,注册失败!', '', 'error');
                        thisBtn.disabled = false;
                        thisBtn.value = 'Sign up';
                    }
                },
                error: function () {
                    if (data.code == 1) {
                        swal('注册成功!', '', 'success');
                        setTimeout(function () {
                            window.location.href = data.url;
                        }, 1000);

                    } else if (data.code == -1) {
                        swal(data.msg, '', 'error');
                        thisBtn.disabled = false;
                        thisBtn.value = 'Sign up';
                    } else {
                        swal('系统错误,注册失败!', '', 'error');
                        thisBtn.disabled = false;
                        thisBtn.value = 'Sign up';
                    }
                }
            })
        });

        $("#login-btn").click(function () {
            $.ajax({
                type: 'post',
                url: '/admin/auth/login',
                dataType: 'json',
                data: $("#loginForm").serialize(),
                success: function (data) {
                    if (data.code == -1) {
                        swal(data.msg, '', 'error');
                    } else if (data.code == -2) {
                        swal(data.msg, '', 'error');
                        $('.email-box').show();
                        $('.password-box').hide();
                    } else if (data.code == 1) {
                        swal('登录成功!', '', 'success');
                        setTimeout(function () {
                            window.location.href = data.url;
                        }, 1000);
                    }
                },
                error: function () {
                    swal('网络错误，稍后重试!', '', 'error');
                }
            })


        });

        //重置密码
        $("#reset-btn").click(function () {
            $.ajax({
                type: 'post',
                url: '/resetPassword',
                dataType: 'json',
                data: $("#forgetform").serialize(),
                success: function (data) {
                    if (data.code == 1) {
                        swal('密码重置成功!', '', 'success');
                        setTimeout(function () {
                            window.location.href = data.url;
                        }, 1000);

                    } else if (data.code == -1) {
                        swal(data.msg, '', 'error');
                    } else {
                        swal('系统错误,密码重置失败!', '', 'error');
                    }
                },
                error: function () {
                    swal('网络错误，稍后重试!', '', 'error');
                }
            })
        });


        $(document).keyup(function (event) {
            if (event.keyCode == 13) {
                let url = window.location.href;

                let reg = url.indexOf("toregister");
                let fog = url.indexOf("toforget");
                let log = url.indexOf("tologin");

                if (reg > 0) {
                    $("#register-btn").trigger("click");
                    return false;
                }

                if (fog > 0) {
                    $("#reset-btn").trigger("click");
                    return false;
                }

                if (log > 0) {
                    $("#login-btn").trigger("click");
                    return false;
                }


                $("#login-btn").trigger("click");
                return false;

            }
        });


    })


</script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/v84a3a4012de94ce1a686ba8c167c359c1696973893317"
        integrity="sha512-euoFGowhlaLqXsPWQ48qSkBSCFs3DPRyiwVu3FjR96cMPx+Fr+gpWRhIafcHwqwCqWS42RZhIudOvEI+Ckf6MA=="
        data-cf-beacon='{"rayId":"857d3147eb4faff1","r":1,"version":"2024.2.1","token":"e03378cd4aa4441f976ee7e34e666cc7"}'
        crossorigin="anonymous"></script>
</body>
</html>
